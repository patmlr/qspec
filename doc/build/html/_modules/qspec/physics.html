<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>qspec.physics &mdash; qspec 30.05.2024 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" href="../../_static/css/borders.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/wy-nav-content.css" type="text/css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=861d89a9"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            qspec
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">qspec</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">qspec</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">qspec.physics</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for qspec.physics</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">qspec.physics</span>
<span class="sd">=============</span>

<span class="sd">Module for physical functions useful for CLS.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.constants</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> <span class="k">as</span> <span class="nn">sp</span>

<span class="kn">from</span> <span class="nn">qspec._types</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qspec</span> <span class="kn">import</span> <span class="n">tools</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L_LABEL&#39;</span><span class="p">,</span> <span class="s1">&#39;E_NORM&#39;</span><span class="p">,</span> <span class="s1">&#39;LEMNISCATE&#39;</span><span class="p">,</span> <span class="s1">&#39;mu_N&#39;</span><span class="p">,</span> <span class="s1">&#39;mu_B&#39;</span><span class="p">,</span> <span class="s1">&#39;g_s&#39;</span><span class="p">,</span> <span class="s1">&#39;me_u&#39;</span><span class="p">,</span> <span class="s1">&#39;me_u_d&#39;</span><span class="p">,</span> <span class="s1">&#39;gp_s&#39;</span><span class="p">,</span> <span class="s1">&#39;gn_s&#39;</span><span class="p">,</span>
           <span class="s1">&#39;inv_cm_to_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;freq_to_inv_cm&#39;</span><span class="p">,</span> <span class="s1">&#39;wavelength_to_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;freq_to_wavelength&#39;</span><span class="p">,</span> <span class="s1">&#39;inv_cm_to_wavelength&#39;</span><span class="p">,</span>
           <span class="s1">&#39;wavelength_to_inv_cm&#39;</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_e&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_e_kin&#39;</span><span class="p">,</span> <span class="s1">&#39;e_rest&#39;</span><span class="p">,</span> <span class="s1">&#39;e_kin&#39;</span><span class="p">,</span> <span class="s1">&#39;e_total&#39;</span><span class="p">,</span> <span class="s1">&#39;e_el&#39;</span><span class="p">,</span>
           <span class="s1">&#39;v_e&#39;</span><span class="p">,</span> <span class="s1">&#39;v_e_d1&#39;</span><span class="p">,</span> <span class="s1">&#39;v_el&#39;</span><span class="p">,</span> <span class="s1">&#39;v_el_d1&#39;</span><span class="p">,</span> <span class="s1">&#39;p_v&#39;</span><span class="p">,</span> <span class="s1">&#39;p_e&#39;</span><span class="p">,</span> <span class="s1">&#39;p_el&#39;</span><span class="p">,</span> <span class="s1">&#39;doppler&#39;</span><span class="p">,</span> <span class="s1">&#39;doppler_d1&#39;</span><span class="p">,</span> <span class="s1">&#39;doppler_e_d1&#39;</span><span class="p">,</span>
           <span class="s1">&#39;doppler_el_d1&#39;</span><span class="p">,</span> <span class="s1">&#39;inverse_doppler&#39;</span><span class="p">,</span> <span class="s1">&#39;inverse_doppler_d1&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_atom&#39;</span><span class="p">,</span> <span class="s1">&#39;v_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;photon_recoil&#39;</span><span class="p">,</span>
           <span class="s1">&#39;photon_recoil_v&#39;</span><span class="p">,</span> <span class="s1">&#39;get_f&#39;</span><span class="p">,</span> <span class="s1">&#39;get_m&#39;</span><span class="p">,</span> <span class="s1">&#39;hyperfine&#39;</span><span class="p">,</span> <span class="s1">&#39;lande_n&#39;</span><span class="p">,</span> <span class="s1">&#39;lande_j&#39;</span><span class="p">,</span> <span class="s1">&#39;lande_f&#39;</span><span class="p">,</span> <span class="s1">&#39;zeeman&#39;</span><span class="p">,</span> <span class="s1">&#39;hyper_zeeman&#39;</span><span class="p">,</span>
           <span class="s1">&#39;a_hyper_mu&#39;</span><span class="p">,</span> <span class="s1">&#39;saturation_intensity&#39;</span><span class="p">,</span> <span class="s1">&#39;saturation&#39;</span><span class="p">,</span> <span class="s1">&#39;rabi&#39;</span><span class="p">,</span> <span class="s1">&#39;scattering_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_factor&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_r2&#39;</span><span class="p">,</span>
           <span class="s1">&#39;delta_r4&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_r6&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda_r&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda_rn&#39;</span><span class="p">,</span> <span class="s1">&#39;schmidt_line&#39;</span><span class="p">,</span> <span class="s1">&#39;sellmeier&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_3d&#39;</span><span class="p">,</span> <span class="s1">&#39;boost&#39;</span><span class="p">,</span>
           <span class="s1">&#39;doppler_3d&#39;</span><span class="p">,</span> <span class="s1">&#39;gaussian_beam_3d&#39;</span><span class="p">,</span> <span class="s1">&#39;gaussian_doppler_3d&#39;</span><span class="p">,</span> <span class="s1">&#39;t_xi&#39;</span><span class="p">,</span> <span class="s1">&#39;thermal_v_pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;thermal_v_rvs&#39;</span><span class="p">,</span>
           <span class="s1">&#39;thermal_e_pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;thermal_e_rvs&#39;</span><span class="p">,</span> <span class="s1">&#39;convolved_boltzmann_norm_pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;convolved_thermal_norm_v_pdf&#39;</span><span class="p">,</span>
           <span class="s1">&#39;convolved_thermal_norm_f_pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;convolved_thermal_norm_f_lin_pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;source_energy_pdf&#39;</span><span class="p">]</span>


<span class="n">L_LABEL</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
<span class="n">E_NORM</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">e</span>
<span class="n">LEMNISCATE</span> <span class="o">=</span> <span class="mf">2.6220575543</span>
<span class="n">mu_N</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">physical_constants</span><span class="p">[</span><span class="s1">&#39;nuclear magneton&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">mu_B</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">physical_constants</span><span class="p">[</span><span class="s1">&#39;Bohr magneton&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">g_s</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">physical_constants</span><span class="p">[</span><span class="s1">&#39;electron g factor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">me_u</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">physical_constants</span><span class="p">[</span><span class="s1">&#39;electron mass in u&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">me_u_d</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">physical_constants</span><span class="p">[</span><span class="s1">&#39;electron mass in u&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">gp_s</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">physical_constants</span><span class="p">[</span><span class="s1">&#39;proton g factor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">gn_s</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">physical_constants</span><span class="p">[</span><span class="s1">&#39;neutron g factor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>


<span class="sd">&quot;&quot;&quot; Units &quot;&quot;&quot;</span>


<div class="viewcode-block" id="inv_cm_to_freq"><a class="viewcode-back" href="../../qspec.html#qspec.physics.inv_cm_to_freq">[docs]</a><span class="k">def</span> <span class="nf">inv_cm_to_freq</span><span class="p">(</span><span class="n">k</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param k: The wavenumber k of a transition (1/cm)</span>
<span class="sd">    :returns: The frequency corresponding to the wavenumber k (MHz).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">k</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="mf">1e-4</span></div>


<div class="viewcode-block" id="freq_to_inv_cm"><a class="viewcode-back" href="../../qspec.html#qspec.physics.freq_to_inv_cm">[docs]</a><span class="k">def</span> <span class="nf">freq_to_inv_cm</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param freq: The frequency f of a transition (MHz)</span>
<span class="sd">    :returns: The wavenumber k corresponding to the frequency freq (1/cm).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">freq</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="mf">1e4</span></div>


<div class="viewcode-block" id="wavelength_to_freq"><a class="viewcode-back" href="../../qspec.html#qspec.physics.wavelength_to_freq">[docs]</a><span class="k">def</span> <span class="nf">wavelength_to_freq</span><span class="p">(</span><span class="n">lam</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param lam: The wavelength lambda of a transition (um)</span>
<span class="sd">    :returns: The frequency corresponding to the wavelength lam (MHz).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="n">lam</span></div>


<div class="viewcode-block" id="freq_to_wavelength"><a class="viewcode-back" href="../../qspec.html#qspec.physics.freq_to_wavelength">[docs]</a><span class="k">def</span> <span class="nf">freq_to_wavelength</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param freq: The frequency f of a transition (MHz)</span>
<span class="sd">    :returns: The wavelength corresponding to the frequency freq (um).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="n">freq</span></div>


<div class="viewcode-block" id="inv_cm_to_wavelength"><a class="viewcode-back" href="../../qspec.html#qspec.physics.inv_cm_to_wavelength">[docs]</a><span class="k">def</span> <span class="nf">inv_cm_to_wavelength</span><span class="p">(</span><span class="n">k</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param k: The wavenumber k of a transition (1/cm)</span>
<span class="sd">    :returns: The wavelength corresponding to the wavenumber k (um).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1e4</span> <span class="o">/</span> <span class="n">k</span></div>


<div class="viewcode-block" id="wavelength_to_inv_cm"><a class="viewcode-back" href="../../qspec.html#qspec.physics.wavelength_to_inv_cm">[docs]</a><span class="k">def</span> <span class="nf">wavelength_to_inv_cm</span><span class="p">(</span><span class="n">lam</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param lam: The wavelength lambda of a transition (um)</span>
<span class="sd">    :returns: The wavenumber k corresponding to the wavelength lam (1/cm).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1e4</span> <span class="o">/</span> <span class="n">lam</span></div>


<span class="sd">&quot;&quot;&quot; 1-D kinematics &quot;&quot;&quot;</span>


<div class="viewcode-block" id="beta"><a class="viewcode-back" href="../../qspec.html#qspec.physics.beta">[docs]</a><span class="k">def</span> <span class="nf">beta</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param v: The velocity of a body (m/s).</span>
<span class="sd">    :returns: The velocity v relative to light speed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span></div>


<div class="viewcode-block" id="gamma"><a class="viewcode-back" href="../../qspec.html#qspec.physics.gamma">[docs]</a><span class="k">def</span> <span class="nf">gamma</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param v: The velocity of a body (m/s).</span>
<span class="sd">    :returns: The time-dilation/Lorentz factor corresponding to the velocity v.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">beta</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="gamma_e"><a class="viewcode-back" href="../../qspec.html#qspec.physics.gamma_e">[docs]</a><span class="k">def</span> <span class="nf">gamma_e</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param e: The total energy of a body, including the energy of the rest mass (eV).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :returns: The time-dilation/Lorentz factor corresponding to the total energy e of a body with mass m.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">e</span> <span class="o">/</span> <span class="n">e_rest</span><span class="p">(</span><span class="n">m</span><span class="p">)</span></div>


<div class="viewcode-block" id="gamma_e_kin"><a class="viewcode-back" href="../../qspec.html#qspec.physics.gamma_e_kin">[docs]</a><span class="k">def</span> <span class="nf">gamma_e_kin</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param e: The kinetic energy of a body (eV).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :returns: The time-dilation/Lorentz factor corresponding to the kinetic energy e of a body with mass m.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="o">+</span> <span class="n">gamma_e</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span></div>


<div class="viewcode-block" id="e_rest"><a class="viewcode-back" href="../../qspec.html#qspec.physics.e_rest">[docs]</a><span class="k">def</span> <span class="nf">e_rest</span><span class="p">(</span><span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param m: The mass of a body (amu).</span>
<span class="sd">    :returns: The resting energy of the body with mass m (eV).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">E_NORM</span></div>


<div class="viewcode-block" id="e_kin"><a class="viewcode-back" href="../../qspec.html#qspec.physics.e_kin">[docs]</a><span class="k">def</span> <span class="nf">e_kin</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param v: The velocity of a body (m/s).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: The kinetic energy of a body with velocity v and mass m (eV).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">relativistic</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_rest</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">v</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span> <span class="o">*</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">E_NORM</span></div>


<div class="viewcode-block" id="e_total"><a class="viewcode-back" href="../../qspec.html#qspec.physics.e_total">[docs]</a><span class="k">def</span> <span class="nf">e_total</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param v: The velocity of a body (m/s).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :returns: The total energy of a body with velocity v and mass m (eV). &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">gamma</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_rest</span><span class="p">(</span><span class="n">m</span><span class="p">)</span></div>


<div class="viewcode-block" id="e_el"><a class="viewcode-back" href="../../qspec.html#qspec.physics.e_el">[docs]</a><span class="k">def</span> <span class="nf">e_el</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param u: The electric potential difference (V).</span>
<span class="sd">    :param q: The charge of a body (e).</span>
<span class="sd">    :returns: The potential energy difference of a body with charge q inside an electric potential with voltage u (eV).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">q</span> <span class="o">*</span> <span class="n">u</span></div>


<div class="viewcode-block" id="v_e"><a class="viewcode-back" href="../../qspec.html#qspec.physics.v_e">[docs]</a><span class="k">def</span> <span class="nf">v_e</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param e: Energy which is added to the kinetic energy of a body with velocity v0 (eV).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :param v0: The initial velocity of the body (m/s).</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: The velocity of a body with mass m and velocity v0 after the addition of the kinetic energy e (m/s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">relativistic</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="o">+</span> <span class="n">gamma_e</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">)))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">v0</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v0</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="n">E_NORM</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span><span class="p">))</span></div>


<div class="viewcode-block" id="v_e_d1"><a class="viewcode-back" href="../../qspec.html#qspec.physics.v_e_d1">[docs]</a><span class="k">def</span> <span class="nf">v_e_d1</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param e: Energy which is added to the kinetic energy of a body with velocity v0 (eV).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :param v0: The initial velocity of the body (m/s).</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: The first derivative of &#39;v_e&#39; regarding &#39;e&#39; (m/(s eV)).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">dv</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span> <span class="o">*</span> <span class="n">v_e</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="n">relativistic</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">relativistic</span><span class="p">:</span>
        <span class="n">dv</span> <span class="o">/=</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="o">+</span> <span class="n">gamma_e</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span> <span class="o">**</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">dv</span> <span class="o">*</span> <span class="n">E_NORM</span></div>


<div class="viewcode-block" id="v_el"><a class="viewcode-back" href="../../qspec.html#qspec.physics.v_el">[docs]</a><span class="k">def</span> <span class="nf">v_el</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param u: The electric potential difference added to the kinetic energy of a body with velocity v0 (V).</span>
<span class="sd">    :param q: The charge of a body (e).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :param v0: The initial velocity of the body (m/s).</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: The velocity of a body with starting velocity v0, charge q and mass m</span>
<span class="sd">     after electrostatic acceleration with voltage u (m/s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">v_e</span><span class="p">(</span><span class="n">e_el</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="n">relativistic</span><span class="p">)</span></div>


<div class="viewcode-block" id="v_el_d1"><a class="viewcode-back" href="../../qspec.html#qspec.physics.v_el_d1">[docs]</a><span class="k">def</span> <span class="nf">v_el_d1</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param u: The electric potential difference added to the kinetic energy of a body with velocity v0 (V).</span>
<span class="sd">    :param q: The charge of a body (e).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :param v0: The initial velocity of the body (m/s).</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: The first derivative of &#39;v_el&#39; regarding &#39;u&#39; (m/(s V)).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">v_e_d1</span><span class="p">(</span><span class="n">e_el</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="n">relativistic</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span></div>


<div class="viewcode-block" id="p_v"><a class="viewcode-back" href="../../qspec.html#qspec.physics.p_v">[docs]</a><span class="k">def</span> <span class="nf">p_v</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param v: The velocity of a body (m/s).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: The momentum of a body with velocity v and mass m.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">relativistic</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gamma</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span> <span class="o">*</span> <span class="n">v</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span> <span class="o">*</span> <span class="n">v</span></div>


<div class="viewcode-block" id="p_e"><a class="viewcode-back" href="../../qspec.html#qspec.physics.p_e">[docs]</a><span class="k">def</span> <span class="nf">p_e</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">p0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param e: Energy which is added to the kinetic energy of a body with velocity v0 (eV).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :param p0: The initial momentum of the body (amu m/s).</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: The momentum of a body with starting momentum p0 and mass m</span>
<span class="sd">     after the addition of the kinetic energy e (amu m/s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e</span><span class="p">,</span> <span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">relativistic</span><span class="p">:</span>
        <span class="n">pc_square</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">E_NORM</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">e</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pc_square</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pc_square</span> <span class="o">+</span> <span class="n">e_rest</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p0</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="n">E_NORM</span><span class="p">)</span></div>


<div class="viewcode-block" id="p_el"><a class="viewcode-back" href="../../qspec.html#qspec.physics.p_el">[docs]</a><span class="k">def</span> <span class="nf">p_el</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">p0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param u: The electric potential difference added to the kinetic energy of a body with velocity v0 (V).</span>
<span class="sd">    :param q: The charge of a body (e).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :param p0: The initial momentum of the body (amu m/s).</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: The momentum of a body with starting momentum p0, charge q and mass m</span>
<span class="sd">     after electrostatic acceleration with voltage u.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">p_e</span><span class="p">(</span><span class="n">e_el</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="n">relativistic</span><span class="p">)</span></div>


<div class="viewcode-block" id="doppler"><a class="viewcode-back" href="../../qspec.html#qspec.physics.doppler">[docs]</a><span class="k">def</span> <span class="nf">doppler</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: The frequency of light (arb. units).</span>
<span class="sd">    :param v: The velocity of a body (m/s).</span>
<span class="sd">    :param alpha: The angle between the velocity- and the wave-vector in the laboratory frame (rad).</span>
<span class="sd">    :param return_frame: The coordinate system in which the frequency is returned. Can be either &#39;atom&#39; or &#39;lab&#39;.</span>
<span class="sd">    :returns: the Doppler-shifted frequency in either the rest frame of the atom or the laboratory frame ([f]).</span>
<span class="sd">    :raises ValueError: rest_frame must be either &#39;atom&#39; or &#39;lab&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_frame</span> <span class="o">==</span> <span class="s1">&#39;atom&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return freq in the atomic system, alpha=0 == Col, alpha in laboratory system &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">f</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">beta</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">return_frame</span> <span class="o">==</span> <span class="s1">&#39;lab&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return freq in the laboratory system, alpha=0 == Col, alpha in laboratory system &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">beta</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;rest_frame must be either &quot;atom&quot; or &quot;lab&quot;.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="doppler_d1"><a class="viewcode-back" href="../../qspec.html#qspec.physics.doppler_d1">[docs]</a><span class="k">def</span> <span class="nf">doppler_d1</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: The frequency of light (arb. units).</span>
<span class="sd">    :param v: The velocity of a body (m/s).</span>
<span class="sd">    :param alpha: The angle between the velocity- and the wave-vector in the laboratory frame (rad).</span>
<span class="sd">    :param return_frame: The coordinate system in which the frequency is returned. Can be either &#39;atom&#39; or &#39;lab&#39;.</span>
<span class="sd">    :returns: the first derivative of the &#39;doppler&#39; formula regarding &#39;v&#39; ([f] s/m).</span>
<span class="sd">    :raises ValueError: rest_frame must be either &#39;atom&#39; or &#39;lab&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">return_frame</span> <span class="o">==</span> <span class="s1">&#39;atom&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return df/dv in the atomic system, alpha=0 == Col, alpha in laboratory system. &quot;&quot;&quot;</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span>
    <span class="k">elif</span> <span class="n">return_frame</span> <span class="o">==</span> <span class="s1">&#39;lab&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return df/dv in the laboratory system, alpha=0 == Col, alpha in laboratory system. &quot;&quot;&quot;</span>
        <span class="n">f_lab</span> <span class="o">=</span> <span class="n">doppler</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="s1">&#39;lab&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">f_lab</span> <span class="o">/</span> <span class="n">f</span> <span class="o">*</span> <span class="n">doppler_d1</span><span class="p">(</span><span class="n">f_lab</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;rest_frame must be either &quot;atom&quot; or &quot;lab&quot;.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="doppler_e_d1"><a class="viewcode-back" href="../../qspec.html#qspec.physics.doppler_e_d1">[docs]</a><span class="k">def</span> <span class="nf">doppler_e_d1</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
                 <span class="n">v0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: The frequency of light (arb. units).</span>
<span class="sd">    :param alpha: The angle between the velocity- and the wave-vector in the laboratory frame (rad).</span>
<span class="sd">    :param e: Energy which is added to the kinetic energy of a body with velocity v0 (eV).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :param v0: The initial velocity of the body (m/s).</span>
<span class="sd">    :param return_frame: The coordinate system in which the frequency is returned. Can be either &#39;atom&#39; or &#39;lab&#39;.</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: the first derivative of the &#39;doppler&#39; formula regarding &#39;e&#39; ([f]/eV).</span>
<span class="sd">    :raises ValueError: rest_frame must be either &#39;atom&#39; or &#39;lab&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v_e</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="n">relativistic</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">doppler_d1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="n">return_frame</span><span class="p">)</span> <span class="o">*</span> <span class="n">v_e_d1</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="n">relativistic</span><span class="p">)</span></div>


<div class="viewcode-block" id="doppler_el_d1"><a class="viewcode-back" href="../../qspec.html#qspec.physics.doppler_el_d1">[docs]</a><span class="k">def</span> <span class="nf">doppler_el_d1</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
                  <span class="n">v0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: The frequency of light (arb. units).</span>
<span class="sd">    :param alpha: The angle between the velocity- and the wave-vector in the laboratory frame (rad).</span>
<span class="sd">    :param u: The electric potential difference added to the kinetic energy of a body with velocity v0 (V).</span>
<span class="sd">    :param q: The charge of a body (e).</span>
<span class="sd">    :param m: The mass of the body (amu).</span>
<span class="sd">    :param v0: The initial velocity of the body (m/s).</span>
<span class="sd">    :param return_frame: The coordinate system in which the frequency is returned. Can be either &#39;atom&#39; or &#39;lab&#39;.</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: the first derivative of the &#39;doppler&#39; formula regarding &#39;u&#39; ([f]/V).</span>
<span class="sd">    :raises ValueError: rest_frame must be either &#39;atom&#39; or &#39;lab&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v_el</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="n">relativistic</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">doppler_d1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="n">return_frame</span><span class="p">)</span> <span class="o">*</span> <span class="n">v_el_d1</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="n">relativistic</span><span class="p">)</span></div>


<div class="viewcode-block" id="inverse_doppler"><a class="viewcode-back" href="../../qspec.html#qspec.physics.inverse_doppler">[docs]</a><span class="k">def</span> <span class="nf">inverse_doppler</span><span class="p">(</span><span class="n">f_atom</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">f_lab</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;raise-raise&#39;</span><span class="p">,</span> <span class="n">return_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f_lab: The frequency of light in the laboratory frame (arb. units).</span>
<span class="sd">    :param f_atom: The frequency of light in the atoms rest frame ([f_lab]).</span>
<span class="sd">    :param alpha: The angle between the velocity- and the wave-vector in the laboratory frame (rad).</span>
<span class="sd">    :param mode: The mode how to handle numpy.nans and ambiguous velocities. Available options are:</span>
<span class="sd">        * &#39;raise-raise&#39;: Raise an error if there are numpy.nans and if the velocity is ambiguous.</span>
<span class="sd">        * &#39;raise-small&#39;: Raise an error if there are numpy.nans and return the smaller velocity.</span>
<span class="sd">        * &#39;raise-large&#39;: Raise an error if there are numpy.nans and return the larger velocity.</span>
<span class="sd">        * &#39;isnan-raise&#39;: Ignore numpy.nans and raise an error if the velocity is ambiguous.</span>
<span class="sd">        * &#39;isnan-small&#39;: Ignore numpy.nans and return the smaller velocity.</span>
<span class="sd">        * &#39;isnan-large&#39;: Ignore numpy.nans and return the larger velocity.</span>
<span class="sd">    :param return_mask: Whether the mask where the velocity is ambiguous is returned as a second argument.</span>
<span class="sd">    :returns: the velocity required to shift f_lab to f_atom (m/s)</span>
<span class="sd">     and optionally the mask where the velocity is ambiguous.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;raise-raise&#39;</span><span class="p">,</span> <span class="s1">&#39;raise-small&#39;</span><span class="p">,</span> <span class="s1">&#39;raise-large&#39;</span><span class="p">,</span> <span class="s1">&#39;isnan-raise&#39;</span><span class="p">,</span> <span class="s1">&#39;isnan-small&#39;</span><span class="p">,</span> <span class="s1">&#39;isnan-large&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;mode must be in </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modes</span><span class="p">))</span>
    <span class="n">f_lab</span><span class="p">,</span> <span class="n">f_atom</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f_lab</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f_atom</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">scalar_true</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">check_shape</span><span class="p">((),</span> <span class="n">f_lab</span><span class="p">,</span> <span class="n">f_atom</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">return_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scalar_true</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha</span><span class="p">])</span>
    <span class="n">cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">square_sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_atom</span> <span class="o">/</span> <span class="n">f_lab</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">cos</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">nan</span> <span class="o">=</span> <span class="n">square_sum</span> <span class="o">&lt;</span> <span class="mf">1.</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">bet1</span> <span class="o">=</span> <span class="p">(</span><span class="n">cos</span> <span class="o">+</span> <span class="n">f_atom</span> <span class="o">/</span> <span class="n">f_lab</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">square_sum</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">))</span> <span class="o">/</span> <span class="n">square_sum</span>
    <span class="n">bet2</span> <span class="o">=</span> <span class="p">(</span><span class="n">cos</span> <span class="o">-</span> <span class="n">f_atom</span> <span class="o">/</span> <span class="n">f_lab</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">square_sum</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">))</span> <span class="o">/</span> <span class="n">square_sum</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">)</span>
    <span class="n">bet1</span><span class="p">[</span><span class="n">nan</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.</span>
    <span class="n">bet2</span><span class="p">[</span><span class="n">nan</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.</span>
    <span class="n">mask1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">bet1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span>
    <span class="n">mask1</span> <span class="o">+=</span> <span class="n">bet1</span> <span class="o">==</span> <span class="mf">0.</span>
    <span class="n">mask2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">bet2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span>
    <span class="n">mask2</span> <span class="o">+=</span> <span class="n">bet2</span> <span class="o">==</span> <span class="mf">0.</span>
    <span class="n">ambiguous</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="o">~</span><span class="n">mask1</span> <span class="o">+</span> <span class="o">~</span><span class="n">mask2</span><span class="p">)</span>
    <span class="n">nan</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">mask1</span> <span class="o">+</span> <span class="n">mask2</span><span class="p">)</span>
    <span class="n">bet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">square_sum</span><span class="p">)</span>
    <span class="n">bet</span><span class="p">[</span><span class="n">nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="s1">&#39;raise&#39;</span><span class="p">]:</span>
        <span class="n">bet</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bet1</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="n">bet</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="n">bet2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">mode</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;large&#39;</span><span class="p">:</span>
        <span class="n">bet</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="n">bet2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="n">bet</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bet1</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nan</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mode</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Situation is physically impossible for at least one argument.&#39;</span><span class="p">)</span>
        <span class="c1"># print(&#39;WARNING: Situation is physically impossible for at least one argument.&#39;)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ambiguous</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Situation allows two different velocities.&#39;</span><span class="p">)</span>
        <span class="c1"># print(&#39;WARNING: Situation allows two different velocities. Taking the {} velocity.&#39;.format(mode[6:]))</span>
    <span class="k">if</span> <span class="n">return_mask</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">scalar_true</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">bet</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ambiguous</span>
        <span class="k">return</span> <span class="n">bet</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">ambiguous</span>
    <span class="k">if</span> <span class="n">scalar_true</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">bet</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">bet</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span></div>


<div class="viewcode-block" id="inverse_doppler_d1"><a class="viewcode-back" href="../../qspec.html#qspec.physics.inverse_doppler_d1">[docs]</a><span class="k">def</span> <span class="nf">inverse_doppler_d1</span><span class="p">(</span><span class="n">f_atom</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">f_lab</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
                       <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;raise-raise&#39;</span><span class="p">,</span> <span class="n">return_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f_lab: The frequency of light in the laboratory frame (arb. units).</span>
<span class="sd">    :param f_atom: The frequency of light in the atoms rest frame ([f_lab]).</span>
<span class="sd">    :param alpha: The angle between the velocity- and the wave-vector in the laboratory frame (rad).</span>
<span class="sd">    :param mode: The mode how to handle numpy.nans and ambiguous velocities. Available options are:</span>
<span class="sd">        * &#39;raise-raise&#39;: Raise an error if there are numpy.nans and if the velocity is ambiguous.</span>
<span class="sd">        * &#39;raise-small&#39;: Raise an error if there are numpy.nans and return the smaller velocity.</span>
<span class="sd">        * &#39;raise-large&#39;: Raise an error if there are numpy.nans and return the larger velocity.</span>
<span class="sd">        * &#39;isnan-raise&#39;: Ignore numpy.nans and raise an error if the velocity is ambiguous.</span>
<span class="sd">        * &#39;isnan-small&#39;: Ignore numpy.nans and return the smaller velocity.</span>
<span class="sd">        * &#39;isnan-large&#39;: Ignore numpy.nans and return the larger velocity.</span>
<span class="sd">    :param return_mask: Whether the mask where the velocity is ambiguous is returned as a second argument.</span>
<span class="sd">    :returns: the first derivative of the &#39;inverse_doppler&#39; formula regarding f_atom (m/(s MHz)).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f_lab</span><span class="p">,</span> <span class="n">f_atom</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f_lab</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f_atom</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">scalar_true</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">check_shape</span><span class="p">((),</span> <span class="n">f_lab</span><span class="p">,</span> <span class="n">f_atom</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">return_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scalar_true</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha</span><span class="p">])</span>
    <span class="n">v</span><span class="p">,</span> <span class="n">ambiguous</span> <span class="o">=</span> <span class="n">inverse_doppler</span><span class="p">(</span><span class="n">f_atom</span><span class="p">,</span> <span class="n">f_lab</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">return_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">square_sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_atom</span> <span class="o">/</span> <span class="n">f_lab</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">cos</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">bet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">square_sum</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">f_atom</span> <span class="o">/</span> <span class="n">f_lab</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">square_sum</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="s1">&#39;raise&#39;</span><span class="p">]:</span>
        <span class="n">bet</span><span class="p">[</span><span class="n">ambiguous</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">bet</span><span class="p">[</span><span class="n">ambiguous</span><span class="p">]</span>
    <span class="n">bet</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">v</span> <span class="o">*</span> <span class="p">(</span><span class="n">f_atom</span> <span class="o">/</span> <span class="n">f_lab</span><span class="p">)</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span>
    <span class="k">if</span> <span class="n">return_mask</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">scalar_true</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">bet</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_lab</span> <span class="o">*</span> <span class="n">square_sum</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ambiguous</span>
        <span class="k">return</span> <span class="n">bet</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_lab</span> <span class="o">*</span> <span class="n">square_sum</span><span class="p">),</span> <span class="n">ambiguous</span>
    <span class="k">if</span> <span class="n">scalar_true</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">bet</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_lab</span> <span class="o">*</span> <span class="n">square_sum</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">bet</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_lab</span> <span class="o">*</span> <span class="n">square_sum</span><span class="p">)</span></div>


<div class="viewcode-block" id="alpha_atom"><a class="viewcode-back" href="../../qspec.html#qspec.physics.alpha_atom">[docs]</a><span class="k">def</span> <span class="nf">alpha_atom</span><span class="p">(</span><span class="n">alpha</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param alpha: The angle between a velocity- and a wave-vector in the laboratory frame (rad).</span>
<span class="sd">    :param v: The velocity of a body (m/s).</span>
<span class="sd">    :returns: The angle between the velocity- and the wave-vector in the atoms rest frame (rad).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="p">(</span><span class="n">beta</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">beta</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span></div>


<div class="viewcode-block" id="v_rec"><a class="viewcode-back" href="../../qspec.html#qspec.physics.v_rec">[docs]</a><span class="k">def</span> <span class="nf">v_rec</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: The frequency of light in the atoms rest frame (MHz).</span>
<span class="sd">    :param m: The mass of a body (amu).</span>
<span class="sd">    :returns: The change of velocity of an atom at rest</span>
<span class="sd">     due to the absorption of a photon with frequency f (m/s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span></div>


<div class="viewcode-block" id="photon_recoil"><a class="viewcode-back" href="../../qspec.html#qspec.physics.photon_recoil">[docs]</a><span class="k">def</span> <span class="nf">photon_recoil</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: The frequency of light in the atoms rest frame (MHz).</span>
<span class="sd">    :param m: The mass of a body (amu).</span>
<span class="sd">    :returns: The change of a transition frequency of an atom at rest</span>
<span class="sd">     due to the absorption of a photon with frequency f (MHz).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span></div>


<div class="viewcode-block" id="photon_recoil_v"><a class="viewcode-back" href="../../qspec.html#qspec.physics.photon_recoil_v">[docs]</a><span class="k">def</span> <span class="nf">photon_recoil_v</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">f_lab</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param v: The velocity of a body (m/s).</span>
<span class="sd">    :param alpha: The angle between a velocity- and a wave-vector in the laboratory frame (rad).</span>
<span class="sd">    :param f_lab: The frequency of light in the laboratory frame (MHz).</span>
<span class="sd">    :param m: The mass of a body (amu).</span>
<span class="sd">    :returns: The change of a transition frequency of an atom moving with velocity v</span>
<span class="sd">     due to the absorption of a laser photon with frequency f (MHz).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">doppler</span><span class="p">(</span><span class="n">f_lab</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">photon_recoil</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span></div>


<span class="sd">&quot;&quot;&quot; Atomic physics &quot;&quot;&quot;</span>


<div class="viewcode-block" id="get_f"><a class="viewcode-back" href="../../qspec.html#qspec.physics.get_f">[docs]</a><span class="k">def</span> <span class="nf">get_f</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="n">scalar</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">scalar</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param i: The nuclear spin quantum number I.</span>
<span class="sd">    :param j: The electronic total angular momentum quantum number J.</span>
<span class="sd">    :returns: All possible f quantum numbers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)))]</span></div>


<div class="viewcode-block" id="get_m"><a class="viewcode-back" href="../../qspec.html#qspec.physics.get_m">[docs]</a><span class="k">def</span> <span class="nf">get_m</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">scalar</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: The total angular momentum quantum number F (= J if I == 0).</span>
<span class="sd">    :returns: All possible zeeman substates of the specified quantum number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="n">f</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))]</span></div>


<div class="viewcode-block" id="hyperfine"><a class="viewcode-back" href="../../qspec.html#qspec.physics.hyperfine">[docs]</a><span class="k">def</span> <span class="nf">hyperfine</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param i: The nuclear spin quantum number I.</span>
<span class="sd">    :param j: The electronic total angular momentum quantum number J.</span>
<span class="sd">    :param f: The total angular momentum quantum number F.</span>
<span class="sd">    :param a: The magnetic dipole hyperfine constant A (arb. units).</span>
<span class="sd">    :param b: The electric quadrupole hyperfine constant B ([a]).</span>
<span class="sd">    :returns: The hyperfine shift of an atomic state (i, j, f) with hyperfine constants a and b ([a]).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Either i &gt;= 0, j &gt;= 0 or f &gt;= 0 is not fulfilled.&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="ow">or</span> <span class="n">f</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|i - j| &lt;= f &lt;= i + j must be fulfilled.&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="n">k_2</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">k_2</span> <span class="o">/=</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">shift</span> <span class="o">+=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">k_2</span> <span class="o">/</span> <span class="mi">4</span>
    <span class="k">return</span> <span class="n">shift</span></div>


<div class="viewcode-block" id="lande_n"><a class="viewcode-back" href="../../qspec.html#qspec.physics.lande_n">[docs]</a><span class="k">def</span> <span class="nf">lande_n</span><span class="p">(</span><span class="n">gyro</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param gyro: The gyromagnetic ratio (MHz).</span>
<span class="sd">    :returns: The nuclear g-factor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gyro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">gyro</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gyro</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">h</span> <span class="o">/</span> <span class="n">mu_N</span></div>


<div class="viewcode-block" id="lande_j"><a class="viewcode-back" href="../../qspec.html#qspec.physics.lande_j">[docs]</a><span class="k">def</span> <span class="nf">lande_j</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">ll</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">approx_g_s</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param s: The electron spin quantum number S.</span>
<span class="sd">    :param ll: The electronic angular momentum quantum number L.</span>
<span class="sd">    :param j: The electronic total angular momentum quantum number J.</span>
<span class="sd">    :param approx_g_s: Whether to use g_s = -2 or the QED result g_s = -2.0023... .</span>
<span class="sd">    :returns: The electronic g-factor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.</span>
    <span class="n">g</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="k">if</span> <span class="n">approx_g_s</span> <span class="k">else</span> <span class="n">g_s</span>
    <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">ll</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">jj</span> <span class="o">+</span> <span class="n">ls</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">jj</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">+=</span> <span class="p">(</span><span class="n">jj</span> <span class="o">-</span> <span class="n">ls</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">jj</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span>
    <span class="k">return</span> <span class="n">val</span></div>


<div class="viewcode-block" id="lande_f"><a class="viewcode-back" href="../../qspec.html#qspec.physics.lande_f">[docs]</a><span class="k">def</span> <span class="nf">lande_f</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">g_n</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">g_j</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param i: The nuclear spin quantum number I.</span>
<span class="sd">    :param j: The electronic total angular momentum quantum number J.</span>
<span class="sd">    :param f: The total angular momentum quantum number F.</span>
<span class="sd">    :param g_n: The nuclear g-factor.</span>
<span class="sd">    :param g_j: The electronic g-factor.</span>
<span class="sd">    :returns: The hyperfine structure g-factor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">ji</span> <span class="o">=</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">ff</span> <span class="o">+</span> <span class="n">ji</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ff</span><span class="p">)</span> <span class="o">*</span> <span class="n">g_j</span>
    <span class="n">val</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ff</span> <span class="o">-</span> <span class="n">ji</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ff</span><span class="p">)</span> <span class="o">*</span> <span class="n">g_n</span> <span class="o">*</span> <span class="n">mu_N</span> <span class="o">/</span> <span class="n">mu_B</span>
    <span class="k">return</span> <span class="n">val</span></div>


<div class="viewcode-block" id="zeeman"><a class="viewcode-back" href="../../qspec.html#qspec.physics.zeeman">[docs]</a><span class="k">def</span> <span class="nf">zeeman</span><span class="p">(</span><span class="n">m</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">as_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param m: The B-field-axis component quantum number m of the total angular momentum.</span>
<span class="sd">    :param b: The B-field (T).</span>
<span class="sd">    :param g: The g-factor.</span>
<span class="sd">    :param as_freq: The zeeman shift can be returned in energy or frequency units.</span>
<span class="sd">    :returns: The energy shift of an atomic state due to the zeeman effect in energy or frequency units (eV or MHz).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="n">g</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">mu_B</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="n">E_NORM</span>
    <span class="k">if</span> <span class="n">as_freq</span><span class="p">:</span>
        <span class="n">delta</span> <span class="o">/=</span> <span class="n">sc</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="n">E_NORM</span>
    <span class="k">return</span> <span class="n">delta</span></div>


<div class="viewcode-block" id="hyper_zeeman"><a class="viewcode-back" href="../../qspec.html#qspec.physics.hyper_zeeman">[docs]</a><span class="k">def</span> <span class="nf">hyper_zeeman</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">ll</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">g_n</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">a_hyper</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">b_hyper</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
                 <span class="n">g_n_as_gyro</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">as_freq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param i: The nuclear spin quantum number I.</span>
<span class="sd">    :param s: The electron spin quantum number S.</span>
<span class="sd">    :param ll: The electronic angular momentum quantum number L.</span>
<span class="sd">    :param j: The electronic total angular momentum quantum number J.</span>
<span class="sd">    :param f: The total angular momentum quantum number F.</span>
<span class="sd">    :param m: The B-field-axis component quantum number m of the total angular momentum.</span>
<span class="sd">    :param g_n: The nuclear g-factor or the gyromagnetic ratio if g_n_as_gyro == True.</span>
<span class="sd">    :param a_hyper: The magnetic dipole hyperfine constant A (eV or MHz).</span>
<span class="sd">    :param b_hyper: The electric quadrupole hyperfine constant B ([a]).</span>
<span class="sd">    :param b: The B-field (T).</span>
<span class="sd">    :param g_n_as_gyro: Whether g_n is the nuclear g-factor or the gyromagnetic ratio.</span>
<span class="sd">    :param as_freq: The shift can be returned in energy or frequency units.</span>
<span class="sd">    :returns: The total energy shift of an atomic state due to the hyperfine splitting</span>
<span class="sd">     and the zeeman effect in energy or frequency units (eV or MHz).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a_hyper</span><span class="p">,</span> <span class="n">b_hyper</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a_hyper</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b_hyper</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">g_j</span> <span class="o">=</span> <span class="n">lande_j</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ll</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="n">g_f</span> <span class="o">=</span> <span class="n">lande_f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lande_n</span><span class="p">(</span><span class="n">g_n</span><span class="p">)</span> <span class="k">if</span> <span class="n">g_n_as_gyro</span> <span class="k">else</span> <span class="n">g_n</span><span class="p">,</span> <span class="n">g_j</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="n">hyperfine</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">a_hyper</span><span class="p">,</span> <span class="n">b_hyper</span><span class="p">)</span>
    <span class="n">shift</span> <span class="o">+=</span> <span class="n">zeeman</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">g_f</span><span class="p">,</span> <span class="n">as_freq</span><span class="o">=</span><span class="n">as_freq</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">shift</span></div>


<div class="viewcode-block" id="a_hyper_mu"><a class="viewcode-back" href="../../qspec.html#qspec.physics.a_hyper_mu">[docs]</a><span class="k">def</span> <span class="nf">a_hyper_mu</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="n">scalar</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">scalar</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param i: The nuclear spin quantum number I.</span>
<span class="sd">    :param j: The electronic total angular momentum quantum number J.</span>
<span class="sd">    :param mu: The magnetic moment of the nucleus in units of the nuclear magneton (mu_N).</span>
<span class="sd">    :param b: The B-field of the atomic electrons at the nucleus (T).</span>
<span class="sd">    :returns: The hyperfine structure constant A (MHz).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">h</span></div>


<div class="viewcode-block" id="saturation_intensity"><a class="viewcode-back" href="../../qspec.html#qspec.physics.saturation_intensity">[docs]</a><span class="k">def</span> <span class="nf">saturation_intensity</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">a_dipole</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: The frequency of the transition (MHz).</span>
<span class="sd">    :param a: The Einstein A coefficient (MHz).</span>
<span class="sd">    :param a_dipole: The reduced dipole coefficient of the transition (see algebra.a_dipole).</span>
<span class="sd">    :returns: The saturation intensity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_dipole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a_dipole</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a_dipole</span><span class="p">)</span></div>


<div class="viewcode-block" id="saturation"><a class="viewcode-back" href="../../qspec.html#qspec.physics.saturation">[docs]</a><span class="k">def</span> <span class="nf">saturation</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">a_dipole</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param i: The intensity of the laser (MHz).</span>
<span class="sd">    :param f: The frequency of the transition (MHz).</span>
<span class="sd">    :param a: The Einstein A coefficient (MHz).</span>
<span class="sd">    :param a_dipole: The reduced dipole coefficient of the transition (see algebra.a_dipole).</span>
<span class="sd">    :returns: The saturation parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">i</span> <span class="o">/</span> <span class="n">saturation_intensity</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_dipole</span><span class="p">)</span></div>


<div class="viewcode-block" id="rabi"><a class="viewcode-back" href="../../qspec.html#qspec.physics.rabi">[docs]</a><span class="k">def</span> <span class="nf">rabi</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param a: The Einstein A coefficient (MHz).</span>
<span class="sd">    :param s: The saturation parameter.</span>
<span class="sd">    :returns: The rabi frequency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span></div>


<div class="viewcode-block" id="scattering_rate"><a class="viewcode-back" href="../../qspec.html#qspec.physics.scattering_rate">[docs]</a><span class="k">def</span> <span class="nf">scattering_rate</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param df: The detuning of to be scattered light from the transition.</span>
<span class="sd">     This must be differences of real frequencies, such that w = 2 pi * df (MHz).</span>
<span class="sd">    :param a: The Einstein A coefficient (MHz).</span>
<span class="sd">    :param s: The saturation parameter.</span>
<span class="sd">    :returns: The 2-state-equilibrium scattering-rate of an electronic transition.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.125</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">df</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="mass_factor"><a class="viewcode-back" href="../../qspec.html#qspec.physics.mass_factor">[docs]</a><span class="k">def</span> <span class="nf">mass_factor</span><span class="p">(</span><span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m_ref</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m_d</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m_ref_d</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k_inf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> \
        <span class="o">-&gt;</span> <span class="p">(</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param m: The mass of the isotope (amu).</span>
<span class="sd">    :param m_ref: The mass of the reference isotope (amu). Must be a scalar or have the same shape as &#39;m&#39;.</span>
<span class="sd">    :param m_d: The uncertainty of the mass of the isotope (amu). Must be a scalar or have the same shape as &#39;m&#39;.</span>
<span class="sd">    :param m_ref_d: The uncertainty of the mass of the reference isotope (amu).</span>
<span class="sd">     Must be a scalar or have the same shape as &#39;m&#39;.</span>
<span class="sd">    :param k_inf: Whether the normal mass-shift factor K(NMS) is defined mass independently</span>
<span class="sd">     as m_e * T(inf) (= True) or as m_e * T(A_ref) (= False). Compare (6.4) with (3.17)</span>
<span class="sd">     in [W. H. King, Isotope shifts in atomic spectra (1984)].</span>
<span class="sd">    :returns: the mass factor and its uncertainty needed to calculate modified isotope shifts or charge radii.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">m_d</span><span class="p">,</span> <span class="n">m_ref</span><span class="p">,</span> <span class="n">m_ref_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m_d</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m_ref</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m_ref_d</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">k_inf</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">me_u</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">m_ref</span> <span class="o">+</span> <span class="n">me_u</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">m_ref</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">m_d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">m_ref_d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">mu_d</span> <span class="o">=</span> <span class="p">((</span><span class="n">mu</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">me_u</span><span class="p">)</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">m_ref</span><span class="p">))</span> <span class="o">*</span> <span class="n">m_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">mu_d</span> <span class="o">+=</span> <span class="p">((</span><span class="n">mu</span> <span class="o">/</span> <span class="p">(</span><span class="n">m_ref</span> <span class="o">+</span> <span class="n">me_u</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">m_ref</span><span class="p">))</span> <span class="o">*</span> <span class="n">m_ref_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">mu_d</span> <span class="o">+=</span> <span class="p">((</span><span class="n">mu</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">me_u</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu</span> <span class="o">/</span> <span class="p">(</span><span class="n">m_ref</span> <span class="o">+</span> <span class="n">me_u</span><span class="p">))</span> <span class="o">*</span> <span class="n">me_u_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">me_u</span><span class="p">)</span> <span class="o">*</span> <span class="n">m_ref</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">m_ref</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">m_d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">m_ref_d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">mu_d</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">m_ref</span> <span class="o">*</span> <span class="p">(</span><span class="n">m_ref</span> <span class="o">+</span> <span class="n">me_u</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">m</span> <span class="o">-</span> <span class="n">m_ref</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">mu_d</span> <span class="o">+=</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">me_u</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">m</span> <span class="o">-</span> <span class="n">m_ref</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m_ref_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">mu_d</span> <span class="o">+=</span> <span class="p">(</span><span class="n">m_ref</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">m_ref</span><span class="p">)</span> <span class="o">*</span> <span class="n">me_u_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu_d</span><span class="p">)</span></div>


<div class="viewcode-block" id="delta_r2"><a class="viewcode-back" href="../../qspec.html#qspec.physics.delta_r2">[docs]</a><span class="k">def</span> <span class="nf">delta_r2</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">r_d</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">r_ref</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">r_ref_d</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
             <span class="n">delta_r</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">delta_r_d</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v2</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v2_ref</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param r: The Barrett radius of an isotope.</span>
<span class="sd">    :param r_d: The uncertainty of the Barrett radius.</span>
<span class="sd">    :param r_ref: The Barrett radius of a reference isotope.</span>
<span class="sd">    :param r_ref_d: The uncertainty of the Barrett radius of the reference isotope.</span>
<span class="sd">    :param delta_r: The difference between the Barrett radius of the isotope and the reference isotope.</span>
<span class="sd">    :param delta_r_d: The uncertainty of the difference between</span>
<span class="sd">     the Barrett radius of the isotope and the reference isotope.</span>
<span class="sd">    :param v2: The V2 factor of the isotope.</span>
<span class="sd">    :param v2_ref: The V2 factor of the reference isotope.</span>
<span class="sd">    :returns: The difference of the mean square nuclear charge radius between two isotopes and its uncertainty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">r_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">r_ref</span><span class="p">,</span> <span class="n">r_ref_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_ref</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_ref_d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">delta_r</span><span class="p">,</span> <span class="n">delta_r_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">delta_r</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">delta_r_d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">v2</span><span class="p">,</span> <span class="n">v2_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v2_ref</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">sum_term</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">r_ref</span> <span class="o">/</span> <span class="n">v2_ref</span><span class="p">)</span> <span class="o">/</span> <span class="n">v2</span>
    <span class="n">delta_term</span> <span class="o">=</span> <span class="n">delta_r</span> <span class="o">+</span> <span class="n">r_ref</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">v2_ref</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">sum_term</span> <span class="o">*</span> <span class="n">delta_term</span>  <span class="c1"># (r/v2)**2 - (r_ref/v2_ref)**2</span>

    <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum_term</span> <span class="o">*</span> <span class="n">delta_r_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">err</span> <span class="o">+=</span> <span class="p">(</span><span class="n">delta_term</span> <span class="o">*</span> <span class="n">r_d</span> <span class="o">/</span> <span class="p">(</span><span class="n">v2</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">err</span> <span class="o">+=</span> <span class="p">((</span><span class="n">delta_term</span> <span class="o">/</span> <span class="p">(</span><span class="n">v2</span> <span class="o">*</span> <span class="n">v2_ref</span><span class="p">)</span> <span class="o">+</span> <span class="n">sum_term</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">v2_ref</span><span class="p">))</span> <span class="o">*</span> <span class="n">r_ref_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>


<div class="viewcode-block" id="delta_r4"><a class="viewcode-back" href="../../qspec.html#qspec.physics.delta_r4">[docs]</a><span class="k">def</span> <span class="nf">delta_r4</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">r_d</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">r_ref</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">r_ref_d</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
             <span class="n">delta_r</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">delta_r_d</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v4</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v4_ref</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param r: The Barrett radius of an isotope.</span>
<span class="sd">    :param r_d: The uncertainty of the Barrett radius.</span>
<span class="sd">    :param r_ref: The Barrett radius of a reference isotope.</span>
<span class="sd">    :param r_ref_d: The uncertainty of the Barrett radius of the reference isotope.</span>
<span class="sd">    :param delta_r: The difference between the Barrett radius of the isotope and the reference isotope.</span>
<span class="sd">    :param delta_r_d: The uncertainty of the difference between</span>
<span class="sd">     the Barrett radius of the isotope and the reference isotope.</span>
<span class="sd">    :param v4: The V4 factor of the isotope.</span>
<span class="sd">    :param v4_ref: The V4 factor of the reference isotope.</span>
<span class="sd">    :returns: The difference of the mean quartic nuclear charge radius between two isotopes and its uncertainty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">r_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">r_ref</span><span class="p">,</span> <span class="n">r_ref_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_ref</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_ref_d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">delta_r</span><span class="p">,</span> <span class="n">delta_r_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">delta_r</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">delta_r_d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">v4</span><span class="p">,</span> <span class="n">v4_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v4_ref</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">sum_term</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">v4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">r_ref</span> <span class="o">/</span> <span class="n">v4_ref</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">delta_term</span> <span class="o">=</span> <span class="n">delta_r2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r_d</span><span class="p">,</span> <span class="n">r_ref</span><span class="p">,</span> <span class="n">r_ref_d</span><span class="p">,</span> <span class="n">delta_r</span><span class="p">,</span> <span class="n">delta_r_d</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">v4_ref</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">sum_term</span> <span class="o">*</span> <span class="n">delta_term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># (r/v4)**4 - (r_ref/v4_ref)**4</span>

    <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum_term</span> <span class="o">*</span> <span class="n">delta_term</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">err</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">delta_term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">r_d</span> <span class="o">/</span> <span class="p">(</span><span class="n">v4</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">err</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">delta_term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_ref</span> <span class="o">*</span> <span class="n">r_ref_d</span> <span class="o">/</span> <span class="p">(</span><span class="n">v4_ref</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>


<div class="viewcode-block" id="delta_r6"><a class="viewcode-back" href="../../qspec.html#qspec.physics.delta_r6">[docs]</a><span class="k">def</span> <span class="nf">delta_r6</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">r_d</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">r_ref</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">r_ref_d</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
             <span class="n">delta_r</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">delta_r_d</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v6</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v6_ref</span><span class="p">:</span> <span class="n">array_like</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param r: The Barrett radius of an isotope.</span>
<span class="sd">    :param r_d: The uncertainty of the Barrett radius.</span>
<span class="sd">    :param r_ref: The Barrett radius of a reference isotope.</span>
<span class="sd">    :param r_ref_d: The uncertainty of the Barrett radius of the reference isotope.</span>
<span class="sd">    :param delta_r: The difference between the Barrett radius of the isotope and the reference isotope.</span>
<span class="sd">    :param delta_r_d: The uncertainty of the difference between</span>
<span class="sd">     the Barrett radius of the isotope and the reference isotope.</span>
<span class="sd">    :param v6: The V6 factor of the isotope.</span>
<span class="sd">    :param v6_ref: The V6 factor of the reference isotope.</span>
<span class="sd">    :returns: The difference of the mean sextic nuclear charge radius between two isotopes and its uncertainty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">r_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">r_ref</span><span class="p">,</span> <span class="n">r_ref_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_ref</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_ref_d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">delta_r</span><span class="p">,</span> <span class="n">delta_r_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">delta_r</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">delta_r_d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">v6</span><span class="p">,</span> <span class="n">v6_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v6_ref</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">sum_term</span> <span class="o">=</span> <span class="p">(</span><span class="n">v6</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">r</span> <span class="o">/</span> <span class="n">v6</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">r_ref</span> <span class="o">/</span> <span class="n">v6_ref</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">delta_r4</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r_d</span><span class="p">,</span> <span class="n">r_ref</span><span class="p">,</span> <span class="n">r_ref_d</span><span class="p">,</span> <span class="n">delta_r</span><span class="p">,</span> <span class="n">delta_r_d</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v6_ref</span><span class="p">)</span>
    <span class="n">delta_term</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">r_ref</span> <span class="o">/</span> <span class="n">v6_ref</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">v6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">v6_ref</span> <span class="o">/</span> <span class="n">r_ref</span><span class="p">))</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">sum_term</span> <span class="o">*</span> <span class="n">delta_term</span>  <span class="c1"># (r/v6)**6 - (r_ref/v6_ref)**6</span>

    <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum_term</span> <span class="o">*</span> <span class="n">delta</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">err</span> <span class="o">+=</span> <span class="p">((</span><span class="o">-</span><span class="p">(</span><span class="n">r_ref</span> <span class="o">/</span> <span class="n">v6_ref</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sum_term</span> <span class="o">/</span> <span class="n">v6</span>
             <span class="o">+</span> <span class="n">delta_term</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">sum_term</span> <span class="o">/</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="n">v6</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="n">r_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">err</span> <span class="o">+=</span> <span class="p">(((</span><span class="mi">4</span> <span class="o">*</span> <span class="n">r_ref</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">v6_ref</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">v6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">v6_ref</span> <span class="o">/</span> <span class="n">r_ref</span><span class="p">))</span>
              <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">v6</span><span class="p">)</span> <span class="o">*</span> <span class="n">r_ref</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">v6_ref</span> <span class="o">**</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">sum_term</span>
             <span class="o">+</span> <span class="n">delta_term</span> <span class="o">*</span> <span class="mf">3.</span> <span class="o">*</span> <span class="p">(</span><span class="n">v6</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">r_ref</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">v6_ref</span> <span class="o">**</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">r_ref_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>


<div class="viewcode-block" id="lambda_r"><a class="viewcode-back" href="../../qspec.html#qspec.physics.lambda_r">[docs]</a><span class="k">def</span> <span class="nf">lambda_r</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r_d</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r_ref_d</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">delta_r</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">delta_r_d</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
             <span class="n">v2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">v2_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">v4</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">v4_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">v6</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">v6_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c2c1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c3c1</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param r: The Barrett radius of an isotope.</span>
<span class="sd">    :param r_d: The uncertainty of the Barrett radius.</span>
<span class="sd">    :param r_ref: The Barrett radius of a reference isotope.</span>
<span class="sd">    :param r_ref_d: The uncertainty of the Barrett radius of the reference isotope.</span>
<span class="sd">    :param delta_r: The difference between the Barrett radius of the isotope and the reference isotope.</span>
<span class="sd">    :param delta_r_d: The uncertainty of the difference between</span>
<span class="sd">     the Barrett radius of the isotope and the reference isotope.</span>
<span class="sd">    :param v2: The V2 factor of the isotope.</span>
<span class="sd">    :param v2_ref: The V2 factor of the reference isotope.</span>
<span class="sd">    :param v4: The V4 factor of the isotope.</span>
<span class="sd">    :param v4_ref: The V4 factor of the reference isotope.</span>
<span class="sd">    :param v6: The V6 factor of the isotope.</span>
<span class="sd">    :param v6_ref: The V6 factor of the reference isotope.</span>
<span class="sd">    :param c2c1: Seltzer&#39;s coefficient for the quartic moment.</span>
<span class="sd">    :param c3c1: Seltzer&#39;s coefficient for the sextic moment.</span>
<span class="sd">    :returns: The difference of the mean sextic nuclear charge radius between two isotopes and its uncertainty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">delta_r2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r_d</span><span class="p">,</span> <span class="n">r_ref</span><span class="p">,</span> <span class="n">r_ref_d</span><span class="p">,</span> <span class="n">delta_r</span><span class="p">,</span> <span class="n">delta_r_d</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v2_ref</span><span class="p">)</span>
    <span class="n">r4</span> <span class="o">=</span> <span class="n">delta_r4</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r_d</span><span class="p">,</span> <span class="n">r_ref</span><span class="p">,</span> <span class="n">r_ref_d</span><span class="p">,</span> <span class="n">delta_r</span><span class="p">,</span> <span class="n">delta_r_d</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">v4_ref</span><span class="p">)</span>
    <span class="n">r6</span> <span class="o">=</span> <span class="n">delta_r6</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r_d</span><span class="p">,</span> <span class="n">r_ref</span><span class="p">,</span> <span class="n">r_ref_d</span><span class="p">,</span> <span class="n">delta_r</span><span class="p">,</span> <span class="n">delta_r_d</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v6_ref</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lambda_rn</span><span class="p">(</span><span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r4</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r6</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r6</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c2c1</span><span class="p">,</span> <span class="n">c3c1</span><span class="p">)</span></div>


<div class="viewcode-block" id="lambda_rn"><a class="viewcode-back" href="../../qspec.html#qspec.physics.lambda_rn">[docs]</a><span class="k">def</span> <span class="nf">lambda_rn</span><span class="p">(</span><span class="n">r_2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r_2_d</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r_4</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r_4_d</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r_6</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r_6_d</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c2c1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c3c1</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param r_2: The difference of the mean square nuclear charge radius between two isotopes.</span>
<span class="sd">    :param r_2_d: The uncertainty of the difference of the mean square nuclear charge radius.</span>
<span class="sd">    :param r_4: The difference of the mean quartic nuclear charge radius between two isotopes.</span>
<span class="sd">    :param r_4_d: The uncertainty of the difference of the mean quartic nuclear charge radius.</span>
<span class="sd">    :param r_6: The difference of the mean sextic nuclear charge radius between two isotopes.</span>
<span class="sd">    :param r_6_d: The uncertainty of the difference of the mean sextic nuclear charge radius.</span>
<span class="sd">    :param c2c1: Seltzer&#39;s coefficient for the quartic moment.</span>
<span class="sd">    :param c3c1: Seltzer&#39;s coefficient for the sextic moment.</span>
<span class="sd">    :returns: the Lambda observable for the given differences in mean square, quartic and sextic nuclear charge radii</span>
<span class="sd">     and its uncertainty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">r_2</span> <span class="o">+</span> <span class="n">c2c1</span> <span class="o">*</span> <span class="n">r_4</span> <span class="o">+</span> <span class="n">c3c1</span> <span class="o">*</span> <span class="n">r_6</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">r_2_d</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">err</span> <span class="o">+=</span> <span class="p">(</span><span class="n">c2c1</span> <span class="o">*</span> <span class="n">r_4_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">err</span> <span class="o">+=</span> <span class="p">(</span><span class="n">c3c1</span> <span class="o">*</span> <span class="n">r_6_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>


<div class="viewcode-block" id="schmidt_line"><a class="viewcode-back" href="../../qspec.html#qspec.physics.schmidt_line">[docs]</a><span class="k">def</span> <span class="nf">schmidt_line</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">is_proton</span><span class="p">):</span>
    <span class="n">_g_s</span> <span class="o">=</span> <span class="n">gp_s</span> <span class="k">if</span> <span class="n">is_proton</span> <span class="k">else</span> <span class="n">gn_s</span>
    <span class="n">_g_l</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">is_proton</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">ll</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">j</span> <span class="o">/</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">ll</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">_g_l</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">_g_s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ll</span> <span class="o">*</span> <span class="n">_g_l</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">_g_s</span></div>


<span class="sd">&quot;&quot;&quot; Optics &quot;&quot;&quot;</span>


<div class="viewcode-block" id="sellmeier"><a class="viewcode-back" href="../../qspec.html#qspec.physics.sellmeier">[docs]</a><span class="k">def</span> <span class="nf">sellmeier</span><span class="p">(</span><span class="n">w</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param w: The wavelength in µm.</span>
<span class="sd">    :param a: The a coefficients.</span>
<span class="sd">    :param b: The b coefficients.</span>
<span class="sd">    :return: The index of refraction for the wavelength w and the given material.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_dimension</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">sum_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">a_i</span> <span class="o">*</span> <span class="n">w</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">w</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">b_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">b_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sum_term</span><span class="p">)</span></div>


<span class="sd">&quot;&quot;&quot; 3-D kinematics &quot;&quot;&quot;</span>


<div class="viewcode-block" id="gamma_3d"><a class="viewcode-back" href="../../qspec.html#qspec.physics.gamma_3d">[docs]</a><span class="k">def</span> <span class="nf">gamma_3d</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param v: The velocity 3-vector (m/s).</span>
<span class="sd">    :param axis: The axis along which the vector components are aligned.</span>
<span class="sd">    :returns: The time-dilation/Lorentz factor corresponding to the velocity vector v.</span>
<span class="sd">    :raises ValueError: v must have 3 components along the specified axis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gamma</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span></div>


<div class="viewcode-block" id="boost"><a class="viewcode-back" href="../../qspec.html#qspec.physics.boost">[docs]</a><span class="k">def</span> <span class="nf">boost</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: The 4-vector x in the current rest frame (arb. units).</span>
<span class="sd">    :param v: The velocity 3-vector (m/s).</span>
<span class="sd">    :param axis: The axis along which the vector components are aligned.</span>
<span class="sd">    :returns: The 4-vector x in the coordinate system moving with velocity v relative to the current rest frame ([x]).</span>
<span class="sd">    :raises ValueError: x and v must have 4 and 3 components along the specified axis, respectively.</span>
<span class="sd">     The shapes of x and v must be compatible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_dimension</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">bet</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">bet_abs</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_shape_like</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="n">bet_abs</span><span class="p">,</span> <span class="n">allow_scalar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">bet_abs</span><span class="p">[</span><span class="n">bet_abs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">gam</span> <span class="o">=</span> <span class="n">gamma_3d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">b_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span> <span class="o">+</span> <span class="p">(</span><span class="n">gam</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bet</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bet</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">bet_abs</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                       <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="k">else</span> <span class="p">(</span><span class="n">gam</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bet</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bet</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
                       <span class="o">/</span> <span class="p">(</span><span class="n">bet_abs</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">gam</span><span class="p">,</span> <span class="o">-</span><span class="n">gam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bet</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="o">-</span><span class="n">gam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bet</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span>
                   <span class="o">-</span><span class="n">gam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bet</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)],</span>
                  <span class="p">[</span><span class="o">-</span><span class="n">gam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bet</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="n">b_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">b_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">b_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                  <span class="p">[</span><span class="o">-</span><span class="n">gam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bet</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="n">b_xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">b_xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">b_xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                  <span class="p">[</span><span class="o">-</span><span class="n">gam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bet</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="n">b_xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">b_xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">b_xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]])</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">axis</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)))</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">axis</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span></div>


<div class="viewcode-block" id="doppler_3d"><a class="viewcode-back" href="../../qspec.html#qspec.physics.doppler_3d">[docs]</a><span class="k">def</span> <span class="nf">doppler_3d</span><span class="p">(</span><span class="n">k</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param k: The k-wave-3-vector of light (arb. units).</span>
<span class="sd">    :param v: The velocity 3-vector (m/s).</span>
<span class="sd">    :param return_frame: The coordinate system in which the frequency is returned. Can be either &#39;atom&#39; or &#39;lab&#39;.</span>
<span class="sd">    :param axis: The axis along which the vector components are aligned.</span>
<span class="sd">    :returns: the Doppler-shifted k-wave-4-vector in either the rest frame of the atom or the laboratory frame ([k]).</span>
<span class="sd">    :raises ValueError: rest_frame must be either &#39;atom&#39; or &#39;lab&#39;. The shapes of k and v must be compatible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">k_0</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">k_4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">k_0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="n">k</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_frame</span> <span class="o">==</span> <span class="s1">&#39;atom&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return k in the atomic system. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">boost</span><span class="p">(</span><span class="n">k_4</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">return_frame</span> <span class="o">==</span> <span class="s1">&#39;lab&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return k in the laboratory system. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">boost</span><span class="p">(</span><span class="n">k_4</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;rest_frame must be either &quot;atom&quot; or &quot;lab&quot;.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="gaussian_beam_3d"><a class="viewcode-back" href="../../qspec.html#qspec.physics.gaussian_beam_3d">[docs]</a><span class="k">def</span> <span class="nf">gaussian_beam_3d</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">w0</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
                     <span class="n">r0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">p0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param r: The position 3-vector where to calculate the beam intensity (m).</span>
<span class="sd">    :param k: The k-wave-3-vector of light (rad / m).</span>
<span class="sd">    :param w0: The beam waist (m).</span>
<span class="sd">    :param r0: The position 3-vector of the beam waist. Is (0m, 0m, 0m) if r0 is not specified (m).</span>
<span class="sd">    :param p0: The total power propagated by the gaussian beam. Is 1W if p0 is not specified (W).</span>
<span class="sd">    :param axis: The axis along which the vector components are aligned.</span>
<span class="sd">    :returns: The intensity of a gaussian beam with k-wave-vector k at the position r - r0 (W/m**2 == µW/mm**2).</span>
<span class="sd">    :raises ValueError: r, k and r0 must have 3 components along the specified axis.</span>
<span class="sd">     The shapes of r, k, w0, r0 and p0 must be compatible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">r0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="c1"># tools.check_shape_like(np.sum(r, axis=axis), np.sum(k, axis=axis), w0, np.sum(r0, axis=axis), p0)</span>
    <span class="n">k_abs</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">e_r</span><span class="p">,</span> <span class="n">e_theta</span><span class="p">,</span> <span class="n">e_phi</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">orthonormal</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">r0</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_theta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">r0</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_phi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">r0</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_r</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w0</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k_abs</span>
    <span class="n">w_z</span> <span class="o">=</span> <span class="n">w0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">z0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">p0</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w_z</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho</span> <span class="o">/</span> <span class="n">w_z</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="gaussian_doppler_3d"><a class="viewcode-back" href="../../qspec.html#qspec.physics.gaussian_doppler_3d">[docs]</a><span class="k">def</span> <span class="nf">gaussian_doppler_3d</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">w0</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">r0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param r: The position 3-vector relative to &#39;r0&#39; where to calculate the doppler-shifted wave number (m).</span>
<span class="sd">    :param k: The k-wave-3-vector of light (rad / m).</span>
<span class="sd">    :param w0: The beam waist (m).</span>
<span class="sd">    :param v: The velocity 3-vector (m/s).</span>
<span class="sd">    :param r0: The position 3-vector of the beam waist. Is (0m, 0m, 0m) if r0 is not specified (m).</span>
<span class="sd">    :param axis: The axis along which the vector components are aligned.</span>
<span class="sd">    :returns: The length of the k-wave-3-vector in the atoms rest frame (rad / m).</span>
<span class="sd">    :raises ValueError: r, k, v and r0 must have 3 components along the specified axis.</span>
<span class="sd">     The shapes of r, k, w0, v and r0 must be compatible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">r0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_shape_like</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w0</span><span class="p">),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>
    <span class="n">k_abs</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">e_r</span><span class="p">,</span> <span class="n">e_theta</span><span class="p">,</span> <span class="n">e_phi</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">orthonormal</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">r0</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_theta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">r0</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_phi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">r0</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_r</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">z_0</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w0</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k_abs</span>
    <span class="n">z_plus</span> <span class="o">=</span> <span class="n">z</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">z_0</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">z_minus</span> <span class="o">=</span> <span class="n">z</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">z_0</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">bet_abs</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">k_abs</span> <span class="o">*</span> <span class="n">gamma_3d</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">bet_abs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">w0</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">z_plus</span>
                                                                  <span class="o">-</span> <span class="n">rho</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">z_minus</span> <span class="o">/</span> <span class="p">(</span><span class="n">z_plus</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
                                  <span class="o">-</span> <span class="n">bet_abs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">z</span> <span class="o">/</span> <span class="n">z_plus</span><span class="p">)</span></div>


<span class="sd">&quot;&quot;&quot; Probability distributions &quot;&quot;&quot;</span>


<div class="viewcode-block" id="t_xi"><a class="viewcode-back" href="../../qspec.html#qspec.physics.t_xi">[docs]</a><span class="k">def</span> <span class="nf">t_xi</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param xi: The acceleration/bunching parameter xi (MHz).</span>
<span class="sd">    :param f: The rest-frame transition frequency (MHz).</span>
<span class="sd">    :param u: The acceleration voltage (V).</span>
<span class="sd">    :param q: The charge of the ions (e).</span>
<span class="sd">    :param m: The mass of the ensembles bodies (u).</span>
<span class="sd">    :returns: The temperature of an ensemble of ions with acceleration/bunching parameter xi (K).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">xi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">u</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">u</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">gamma_e_kin</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">u</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span></div>


<div class="viewcode-block" id="thermal_v_pdf"><a class="viewcode-back" href="../../qspec.html#qspec.physics.thermal_v_pdf">[docs]</a><span class="k">def</span> <span class="nf">thermal_v_pdf</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param v: velocity quantiles (m/s).</span>
<span class="sd">    :param m: The mass of the ensembles bodies (u).</span>
<span class="sd">    :param t: The temperature of the ensemble (K).</span>
<span class="sd">    :returns: The probability density in thermal equilibrium at the velocity v (s/m).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span></div>


<div class="viewcode-block" id="thermal_v_rvs"><a class="viewcode-back" href="../../qspec.html#qspec.physics.thermal_v_rvs">[docs]</a><span class="k">def</span> <span class="nf">thermal_v_rvs</span><span class="p">(</span><span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param m: The mass of the ensembles bodies (u).</span>
<span class="sd">    :param t: The temperature of the ensemble (K).</span>
<span class="sd">    :param size: Either the size (int) or shape (tuple) of the returned velocity array.</span>
<span class="sd">     If &#39;m&#39; or &#39;t&#39; is an iterable/array, their common shape must be appended to the desired shape of the random samples.</span>
<span class="sd">    :returns: Random velocities according to the thermal equilibrium distribution (m/s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="thermal_e_pdf"><a class="viewcode-back" href="../../qspec.html#qspec.physics.thermal_e_pdf">[docs]</a><span class="k">def</span> <span class="nf">thermal_e_pdf</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param e: energy quantiles (eV).</span>
<span class="sd">    :param t: The temperature of the ensemble (K).</span>
<span class="sd">    :returns: The probability density at the energy e, distributed according to a boltzmann distribution (1/eV).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">E_NORM</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span></div>


<div class="viewcode-block" id="thermal_e_rvs"><a class="viewcode-back" href="../../qspec.html#qspec.physics.thermal_e_rvs">[docs]</a><span class="k">def</span> <span class="nf">thermal_e_rvs</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param t: The temperature of the ensemble (K).</span>
<span class="sd">    :param size: Either the size (int) or shape (tuple) of the returned energy array.</span>
<span class="sd">     If &#39;t&#39; is an iterable/array, its shape must be appended to the desired shape of the random samples.</span>
<span class="sd">    :returns: Random energies according to the boltzmann distribution (m/s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">E_NORM</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="convolved_boltzmann_norm_pdf"><a class="viewcode-back" href="../../qspec.html#qspec.physics.convolved_boltzmann_norm_pdf">[docs]</a><span class="k">def</span> <span class="nf">convolved_boltzmann_norm_pdf</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">scale_e</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">e0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param e: energy quantiles (eV).</span>
<span class="sd">    :param t: The temperature of the ensemble (K).</span>
<span class="sd">    :param scale_e: The standard deviation of the normal distribution (eV).</span>
<span class="sd">    :param e0: The mean energy of the normal distribution (eV).</span>
<span class="sd">    :returns: The probability density at the energy e, distributed according</span>
<span class="sd">     to a convolution of the boltzmann and a normal distribution (1/eV).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">scale_e</span><span class="p">,</span> <span class="n">e0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">scale_e</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">e0</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">/=</span> <span class="n">E_NORM</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">scale_e</span> <span class="o">/</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">e0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">scale</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">nonzero</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> \
        <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">loc</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">scale</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">main</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">LEMNISCATE</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">))</span>
    <span class="n">main_nonzero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">nonzero</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">&lt;</span> <span class="mf">0.</span>
    <span class="n">main_nonzero</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> \
        <span class="o">*</span> <span class="n">sp</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    <span class="n">main_nonzero</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span> \
        <span class="o">*</span> <span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">ive</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span> <span class="o">+</span> <span class="n">sp</span><span class="o">.</span><span class="n">ive</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]))</span>
    <span class="n">main</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span> <span class="o">=</span> <span class="n">main_nonzero</span> <span class="o">*</span> <span class="n">norm</span>
    <span class="k">return</span> <span class="n">main</span></div>


<div class="viewcode-block" id="convolved_thermal_norm_v_pdf"><a class="viewcode-back" href="../../qspec.html#qspec.physics.convolved_thermal_norm_v_pdf">[docs]</a><span class="k">def</span> <span class="nf">convolved_thermal_norm_v_pdf</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
                                 <span class="n">scale_e</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">e0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param v: velocity quantiles. All values must have the same sign (m/s).</span>
<span class="sd">    :param m: The mass of the ensembles bodies (amu).</span>
<span class="sd">    :param t: The temperature of the ensemble (K).</span>
<span class="sd">    :param scale_e: The standard deviation of the normal distribution (eV).</span>
<span class="sd">    :param e0: The mean energy of the normal distribution (eV).</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: The probability density at the velocity v, corresponding to the kinetic energy, distributed according</span>
<span class="sd">     to a convolution of the boltzmann and a normal distribution (s/m).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">scale_e</span><span class="p">,</span> <span class="n">e0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">scale_e</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">e0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;This pdf can only describe the case where all velocities have the same sign.&#39;</span><span class="p">)</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">e_kin</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">relativistic</span><span class="p">)</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">atomic_mass</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">relativistic</span><span class="p">:</span>
        <span class="n">tr</span> <span class="o">*=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">convolved_boltzmann_norm_pdf</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">scale_e</span><span class="p">,</span> <span class="n">e0</span><span class="o">=</span><span class="n">e0</span><span class="p">)</span> <span class="o">*</span> <span class="n">tr</span> <span class="o">/</span> <span class="n">E_NORM</span></div>


<div class="viewcode-block" id="convolved_thermal_norm_f_pdf"><a class="viewcode-back" href="../../qspec.html#qspec.physics.convolved_thermal_norm_f_pdf">[docs]</a><span class="k">def</span> <span class="nf">convolved_thermal_norm_f_pdf</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">f_lab</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
                                 <span class="n">scale_e</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">e0</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: Frequency quantiles (arb. units).</span>
<span class="sd">    :param f_lab: Laser frequency in the laboratory frame ([f]).</span>
<span class="sd">    :param alpha: Angle between the laser and the atoms velocity direction (rad).</span>
<span class="sd">    :param m: The mass of the ensembles bodies (amu).</span>
<span class="sd">    :param t: The temperature of the ensemble (K).</span>
<span class="sd">    :param scale_e: The standard deviation of the normal distribution (eV).</span>
<span class="sd">    :param e0: The mean energy of the normal distribution (eV).</span>
<span class="sd">    :param relativistic: The calculation is performed either relativistically or classically.</span>
<span class="sd">    :returns: The probability density at the frequency &#39;f&#39; in the atoms rest frame,</span>
<span class="sd">     related to the kinetic energy via the laser frequency &#39;f_lab&#39; and the Doppler effect.</span>
<span class="sd">     The kinetic energies are distributed according to a convolution of the boltzmann and a normal distribution (1/MHz).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">f_lab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f_lab</span><span class="p">)</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">scale_e</span><span class="p">,</span> <span class="n">e0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">scale_e</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">e0</span><span class="p">)</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">inverse_doppler</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f_lab</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;isnan-small&#39;</span><span class="p">)</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">inverse_doppler_d1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f_lab</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;isnan-small&#39;</span><span class="p">))</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">ret</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">convolved_thermal_norm_v_pdf</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">scale_e</span><span class="p">,</span> <span class="n">e0</span><span class="o">=</span><span class="n">e0</span><span class="p">,</span> <span class="n">relativistic</span><span class="o">=</span><span class="n">relativistic</span><span class="p">)</span> <span class="o">*</span> <span class="n">tr</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="convolved_thermal_norm_f_lin_pdf"><a class="viewcode-back" href="../../qspec.html#qspec.physics.convolved_thermal_norm_f_lin_pdf">[docs]</a><span class="k">def</span> <span class="nf">convolved_thermal_norm_f_lin_pdf</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">xi</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: Frequency quantiles (arb. units).</span>
<span class="sd">    :param xi: The proportionality constant between kinetic energy differences and frequency differences ([f]).</span>
<span class="sd">    :param sigma: The standard deviation of the underlying normal distribution in frequency units ([f]).</span>
<span class="sd">    :param col: Col/Acol alignment of the laser relative to the atom beam.</span>
<span class="sd">    :returns: The probability density at the frequency &#39;f&#39; in the atoms rest frame,</span>
<span class="sd">     related to differences in kinetic energy via the proportionality constant &#39;xi&#39;.</span>
<span class="sd">     The kinetic energies are distributed according to a convolution of the boltzmann and a normal distribution (1/[f]).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pm</span> <span class="o">=</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">col</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
    <span class="n">scalar_true</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">check_shape</span><span class="p">((),</span> <span class="n">f</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">return_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scalar_true</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">])</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">/</span> <span class="n">xi</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">sig</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">pm</span> <span class="o">*</span> <span class="n">f</span> <span class="o">/</span> <span class="n">xi</span> <span class="o">-</span> <span class="n">sig</span>
    <span class="n">b_arg</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">sig</span>

    <span class="n">nonzero</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>
    <span class="n">b_arg</span> <span class="o">=</span> <span class="n">b_arg</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>
    <span class="n">main</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">LEMNISCATE</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sig</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
    <span class="n">main_nonzero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">nonzero</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">&lt;</span> <span class="mf">0.</span>

    <span class="n">main_nonzero</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">mu</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> \
        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b_arg</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">sp</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">b_arg</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    <span class="n">main_nonzero</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span> \
        <span class="o">*</span> <span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">ive</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">b_arg</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span> <span class="o">+</span> <span class="n">sp</span><span class="o">.</span><span class="n">ive</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">b_arg</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]))</span>
    <span class="n">main</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span> <span class="o">=</span> <span class="n">main_nonzero</span>
    <span class="k">if</span> <span class="n">scalar_true</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">main</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">norm</span>
    <span class="k">return</span> <span class="n">main</span> <span class="o">*</span> <span class="n">norm</span></div>


<div class="viewcode-block" id="source_energy_pdf"><a class="viewcode-back" href="../../qspec.html#qspec.physics.source_energy_pdf">[docs]</a><span class="k">def</span> <span class="nf">source_energy_pdf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">collinear</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: Frequency quantiles (arb. units).</span>
<span class="sd">    :param f0: Frequency offset (arb. units).</span>
<span class="sd">    :param sigma: The standard deviation of the underlying normal distribution in frequency units ([f]).</span>
<span class="sd">    :param xi: The proportionality constant between kinetic energy differences and frequency differences ([f]).</span>
<span class="sd">    :param collinear:</span>
<span class="sd">    :returns: PDF of rest frame frequencies after acceleration of thermally and normally distributed kinetic energies.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pm</span> <span class="o">=</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">collinear</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">xi</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">sig</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="o">-</span><span class="n">pm</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">f0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">xi</span><span class="p">)</span> <span class="o">-</span> <span class="n">sig</span>
    <span class="n">nonzero</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>
    <span class="n">b_arg</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.</span> <span class="o">*</span> <span class="n">sig</span><span class="p">)</span>
    <span class="n">main</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">LEMNISCATE</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sig</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
    <span class="n">main_nonzero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">nonzero</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">&lt;</span> <span class="mf">0.</span>

    <span class="n">main_nonzero</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">mu</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> \
        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b_arg</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">sp</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">b_arg</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    <span class="n">main_nonzero</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span> \
        <span class="o">*</span> <span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">ive</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">b_arg</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span> <span class="o">+</span> <span class="n">sp</span><span class="o">.</span><span class="n">ive</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">b_arg</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]))</span>
    <span class="n">main</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span> <span class="o">=</span> <span class="n">main_nonzero</span>
    <span class="k">return</span> <span class="n">main</span> <span class="o">*</span> <span class="n">_norm</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Patrick Mueller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>